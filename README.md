# Very Long FileName в Linux
В проекте приведена работа по исследованию различных файловых систем в Linux на пример максимальной длины имени файлов 
и написанию патча для ядра для приведения данного параметра к единому значению.

## Statfs
Проверка файловых систем выполнялась на версии ядра 5.9.0 с помощью стандартной библиотечной функции statfs, которая по пути до файла/директории позволяет узнать информацию о файловой
системе в которой он располагается. 

## Эмуляция раздела диска с необходимой файловой системой
Командой truncate создавался файл размером 1 Гб, вызовом mkfs в этот файл добавлялась рассматриваемая файловая система, затем с помощью команды mount данный файл
монтировался в пустую директорию и на ней запускалась тестовая программа. После выполнения теста вызовом umount раздел отмонтировался и файл с 
директорией удалялись.

## FAT
Результат работы тестовой программы:

```
tf_type: FAT 0x4d44
tf_namelen: 1530
```

Рассмотрим как это значение вычисляется в ядре:

```
f_namelen = (sbi->options.isvfat ? FAT_LFN_LEN : 12) * NLS_MAX_CHARSET_SIZE;
```
Константа FAT\_LFN\_LEN, равная 255 находится в файле include/uapi/linux/msdos_fs.h

NLS\_MAX\_CHARSET\_SIZE находится в файле include/linux/nls.h и равняется 6, хотя с ноября 2003 года пятый и шестой байты в UTF-8 уже не используются при кодировании, 
для обеспечения совместимости с UTF-16.

Таким образом, мы убедились, что полученное в тестовой программе значение корректно.

## exFat
Результат работы тестовой программы:

```
tf_type: FUSE 0x65735546
tf_namelen: 255
```

Файловая система exFAT поддерживается в ядре начиная с версии 5.4, до этого момента создание производилось с помощью FUSE. Удалили пакет exFAT-FUSE:

```
sudo apt-get autoremove exfat-fuse
```

Запустили тестовую программу еще раз, получили следующие результаты:

```
tf_type: exFAT 0x2011bab0
tf_namelen: 1530
```
Рассмотрим, как это значение вычисляется в ядре:

```
f_namelen = EXFAT_MAX_FILE_LEN * NLS_MAX_CHARSET_SIZE;
```

Константа EXFAT\_MAX\_FILE\_LEN равная 255 находится в файле fs/exfat/exfat_raw.h, а NLS\_MAX\_CHARSET\_SIZE в include/linux/nls.h и равняется 6.

Таким образом, мы убедились, что полученное в тестовой программе значение корректно.